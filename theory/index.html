<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Theory · Eternity2Puzzles.jl</title><meta name="title" content="Theory · Eternity2Puzzles.jl"/><meta property="og:title" content="Theory · Eternity2Puzzles.jl"/><meta property="twitter:title" content="Theory · Eternity2Puzzles.jl"/><meta name="description" content="Documentation for Eternity2Puzzles.jl."/><meta property="og:description" content="Documentation for Eternity2Puzzles.jl."/><meta property="twitter:description" content="Documentation for Eternity2Puzzles.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Eternity2Puzzles.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Overview</a></li><li class="is-active"><a class="tocitem" href>Theory</a><ul class="internal"><li><a class="tocitem" href="#Terminology"><span>Terminology</span></a></li><li><a class="tocitem" href="#Symmetries"><span>Symmetries</span></a></li><li><a class="tocitem" href="#Solution-estimates"><span>Solution estimates</span></a></li><li><a class="tocitem" href="#Estimates-with-invalid-joins"><span>Estimates with invalid joins</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../solvers/">Solvers</a></li><li><a class="tocitem" href="../reference/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Theory</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Theory</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/jwortmann/Eternity2Puzzles.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p>It can be useful to create a mathematical model for Eternity II puzzles, in order to compare the efficiencies of different solving strategies without the need to gather empirical results, to find an estimation for the number of solutions, and to derive a measure for the difficulty of a given puzzle. The following section first describes some of the terms that are used in this documentation and also in the source code.</p><h2 id="Terminology"><a class="docs-heading-anchor" href="#Terminology">Terminology</a><a id="Terminology-1"></a><a class="docs-heading-anchor-permalink" href="#Terminology" title="Permalink"></a></h2><p>An Eternity II puzzle is a special kind of edge-matching puzzle on a rectangular grid – the <strong>board</strong> – with a given number of rows and columns. The rows and columns divide the board into a set of <strong>squares</strong>, with each square being identified by a combination of a letter for the row (from top to bottom) and a number for the column (from left to right); for example A1 for the top-left corner square.</p><p>The puzzle <strong>pieces</strong> (or tiles) have one of various colored patterns on each of their four sides. For simplicitly these different edge types are just called the <strong>colors</strong>. One of the edge types that occurs on some of the pieces doesn&#39;t have an actual pattern; this is the grey <strong>border color</strong> and edges of that type are the <strong>border edges</strong>. Border edges must only be placed towards the outside border of the board. We can distinguish between <strong>corner pieces</strong> (pieces with two border edges), <strong>edge pieces</strong> (pieces with one border edge) and <strong>inner pieces</strong> (pieces without border edges), while the set of <strong>frame pieces</strong> consists of the corner pieces and the edge pieces. The <strong>corner squares</strong>, <strong>edge squares</strong>, <strong>inner squares</strong> and <strong>frame squares</strong> are the corresponding positions on the board. A <strong>fixed piece</strong> (or pre-placed piece) is a piece that must be placed with a given rotation on a given square of the board - the original Eternity II puzzle has a single fixed piece on square I8.</p><p>An important property of the Eternity II puzzle is that the set of colors which occur on the edges between two frame pieces, and the set of colors which occur on the edges between two inner pieces and between one inner piece and one frame piece, are disjunct. This separates the colors into <strong>frame colors</strong>, which only occur on frame pieces, and <strong>inner colors</strong>, which occur on the inner pieces and on the inside edges of the edge pieces.</p><p>A <strong>join</strong> describes a pair of edges between two adjacent pieces, and similarly to the frame and inner colors we can further distinguish between <strong>frame joins</strong> and <strong>inner joins</strong>. The joins can either be <strong>valid joins</strong> if both of the edge colors match, or <strong>invalid joins</strong> if they don&#39;t match. Since there is only a single valid rotation for the pieces on the frame squares (determined by the orientation of the border edge), frame joins are always made from two edges with frame colors and inner joins are always made from two edges with inner colors, regardless whether these joins are valid or invalid.</p><p>The <strong>score</strong> of an arrangement of pieces on the board is defined as the total number of valid joins. At the time of writing, the highest known score for the original Eternity II puzzle are 470 valid joins out of the maximum 480.</p><h2 id="Symmetries"><a class="docs-heading-anchor" href="#Symmetries">Symmetries</a><a id="Symmetries-1"></a><a class="docs-heading-anchor-permalink" href="#Symmetries" title="Permalink"></a></h2><p>A puzzle can have three possible types of symmetries, which act as multiplicative factors for the total number of solutions. The symmetries can also be utilized to reduce the number of nodes in the search tree that a backtracking algorithm has to visit in order to find all possible solutions.</p><ol><li><p><strong>Symmetries due to the board</strong>:  For a square board without fixed pieces, any solution rotated by 90°, 180° or 270° is also a solution.  For a rectangular board with different numbers of rows and columns, any solution rotated by 180° gives another solution.  On a square board, fixing one of the four corner pieces reduces the number of nodes for an exhaustive search by an average factor of 4 (the precise number of nodes depends on which particular corner piece was used, because the colors of its edges affect the number of possible candidates for the neighboring pieces and so on).  Similarly, for a rectangular but not square board, fixing one of the corner pieces on one of the corner squares first and then on another corner square that is not directly opposite to the first one, reduces the number of nodes for an exhaustive search by an average factor of 2.</p></li><li><p><strong>Symmetries due to rotationally symmetric individual pieces</strong>:  If a piece has the same edge colors on opposite sides both in vertical and horizontal direction, the piece can be rotated by 180° without affecting the global edge color arrangement on the board.  If all four of its edges have the same color, the piece can be rotated by 90°, 180° or 270°.</p></li><li><p><strong>Symmetries due to rotationally identical pieces</strong>:  If two or more pieces have exactly the same edge colors under some rotation, their positions on the board can be swapped without affecting the global edge color arrangement.  In general, for each set of <span>$n$</span> duplicate pieces there are <span>$n!$</span> permutations for the positions of these pieces with identical edge color arrangement.</p></li></ol><p>The original Eternity II puzzle has neither symmetrical individual nor rotationally identical pieces, and for a valid solution the symmetries due to the board are eliminated by fixing piece 139 on the square I8.</p><h2 id="Solution-estimates"><a class="docs-heading-anchor" href="#Solution-estimates">Solution estimates</a><a id="Solution-estimates-1"></a><a class="docs-heading-anchor-permalink" href="#Solution-estimates" title="Permalink"></a></h2><p>To get an estimate for the number of valid solutions, we can count the total number of possible piece configurations on the board, and multiply that number with the probability that all joins between adjacent edges have matching colors.</p><p>The number of piece configurations – ignoring whether or not adjacent edges match – can be calculated exactly. For the original Eternity II puzzle with 16 rows and 16 columns there are 4 corner pieces, 56 edge pieces and 196 inner pieces, with one of the inner pieces already being fixed with a given rotation on square I8. Under the restriction that the frame pieces must be placed with all their border edges around the outside of the board, we have <span>$4! = 24$</span> different permutations for the arrangement of the corner pieces, <span>$56!$</span> possible configurations of the edge pieces, and <span>$195!\cdot 4^{195}$</span> possible configurations for the inner pieces, including the four rotations for each piece. In total this yields <span>$4!\cdot 56!\cdot 195!\cdot 4^{195}\approx 1.12\cdot 10^{557}$</span> possible configurations for all the pieces.</p><p>The board of the Eternity II puzzle has 60 frame joins and 420 inner joins, and there are 5 different frame colors and 17 different inner colors with flat distributions over the number of edges. A very simple approach is to use the value <span>$1/5$</span> as an approximation for the probability of a valid frame join, and <span>$1/17$</span> for the probability of a valid inner join. If the probabilities of valid joins are assumed to be independent over the entire board, one could simply multiply these values and get the total probability <span>$(1/5)^{60}\cdot (1/17)^{420}\approx 1.88\cdot 10^{-559}$</span> that all of the joins are valid. Then the expected number of solutions is the product from the number of all possible configurations and the probability that all joins for a particular configuration are valid. With the values from above we expect <span>$0.02$</span> solutions, which suggests that the puzzle has only a single solution – the one that was used to generate the puzzle pieces. However, when comparing this method with empirical results from puzzles with fewer pieces, which can be searched exhaustively with a backtracking algorithm, it becomes apparent that this approximation is not very accurate. In fact, it is clear that in practice the probabilities of valid joins are not independent and constant over the whole board; after more and more pieces are correctly placed onto the board, the color distribution over the remaining edges changes and the probability to create valid joins increases as some of the colors get used up.</p><p>A more sophisticated probability model was developed by Brendan Owen [<a href="#Owen2008">1</a>, <a href="#Owen2009">2</a>], which takes into account that the numbers of edges of each color are finite. This model is generalized for any number of fixed pieces on the board, and for any configuration of squares on a partially filled board, which will be useful to estimate the total number of nodes in a search tree that a backtracking algorithm has to visit for an exhaustive search.</p><p>In the following, we use the notation <span>$P(n, k) = n!/(n-k)!$</span> for the number of <span>$k$</span>-permutations of <span>$n$</span>, and <span>$C(n, k) = n!/(k!(n-k)!)$</span> for the number of <span>$k$</span>-combinations of <span>$n$</span> (binomial coefficient).</p><h3 id="Number-of-piece-configurations"><a class="docs-heading-anchor" href="#Number-of-piece-configurations">Number of piece configurations</a><a id="Number-of-piece-configurations-1"></a><a class="docs-heading-anchor-permalink" href="#Number-of-piece-configurations" title="Permalink"></a></h3><p>Let <span>$a_\text{c}$</span> be the number of available corner pieces, <span>$a_\text{e}$</span> be the number of available edge pieces, and <span>$a_\text{i}$</span> be the number of available inner pieces. Each of these numbers are counted without the fixed pieces on the board. Note that these numbers are allowed to be larger than the corresponding numbers of board squares of each type; this makes it possible to, for example, calculate estimations about filling a smaller board with a subset of pieces made from any of the 256 Eternity II pieces.</p><p>Further, for any partially or completed piece configuration on the board, let <span>$p_\text{c}$</span> be the number of placed corner pieces, <span>$p_\text{e}$</span> be the number of placed edge pieces, and <span>$p_\text{i}$</span> be the number of placed inner pieces, but again, counted without any fixed pieces.</p><p>Then, for a specific selection of squares on the board, the number of possible piece configurations that fill these squares, and ignoring whether joins between adjacent pieces match or not, is given by</p><p class="math-container">\[P(p_\text{c}, p_\text{e}, p_\text{i}) = P(a_\text{c}, p_\text{c}) P(a_\text{e}, p_\text{e}) P(a_\text{i}, p_\text{i}) 4^{p_\text{i}} = \frac{a_\text{c}!}{(a_\text{c} - p_\text{c})!}\cdot\frac{a_\text{e}!}{(a_\text{e} - p_\text{e})!}\cdot\frac{a_\text{i}!}{(a_\text{i} - p_\text{i})!} 4^{p_\text{i}}\]</p><h3 id="Matching-probabilities"><a class="docs-heading-anchor" href="#Matching-probabilities">Matching probabilities</a><a id="Matching-probabilities-1"></a><a class="docs-heading-anchor-permalink" href="#Matching-probabilities" title="Permalink"></a></h3><p>The next part is to determine the probability that all the edges are matching. The probability for a particular state of a partially filled board is taken as the ratio between the number of valid combinations for a given number of joins (corresponding to the particular state of the board) and the total number of combinations how that many joins can be made from either matching or non-matching edges with arbitrary colors. This model assumes that the edges can be moved independently from each other, which is not strictly true as groups of four edges are attached to a piece.</p><p>The basic idea of the following method involves to calculate the number of valid combinations by just using a subset of the colors, and then incrementally adding new colors with the help of that result as a building block in the calculation. This process is repeated until all edge types have been taken into account. The concept leads to recursive formulas for the numbers of valid combinations, which can be implemented very efficiently.</p><h3 id="Probabilities-of-valid-frame-joins"><a class="docs-heading-anchor" href="#Probabilities-of-valid-frame-joins">Probabilities of valid frame joins</a><a id="Probabilities-of-valid-frame-joins-1"></a><a class="docs-heading-anchor-permalink" href="#Probabilities-of-valid-frame-joins" title="Permalink"></a></h3><p>It was already mentioned before, that the orientations of the frame pieces are constrained by their border edges. This means that a join between two frame pieces is always made from one &quot;left&quot; edge and one &quot;right&quot; edge.</p><p>Let <span>$B$</span> be the number of different frame colors and assign consecutive numbers from <span>$1$</span> to <span>$B$</span> to those colors. Let <span>$2n_i$</span> be the number of edges of color <span>$i$</span> and <span>$2T_\text{b} = 2\sum_{i=1}^B n_i$</span> be the total number of frame edges over all pieces. Define <span>$V_\text{b}(i, b)$</span> to be the number of valid configurations of how <span>$b$</span> frame joins can be made using <span>$2b$</span> edges of colors <span>$1$</span> to <span>$i$</span>. It is</p><p class="math-container">\[\begin{align*}
V_\text{b}(0, 0) &amp;= 1 \\
V_\text{b}(0, b) &amp;= 0 \quad \text{for} \quad b &gt; 0
\end{align*}\]</p><p>and one can derive the recursive formula</p><p class="math-container">\[V_\text{b}(i, b) = \sum_{j=0}^{n_i} V_\text{b}(i-1, b-j)\cdot P(n_i, j)^2\cdot C(b, j)\]</p><p>by adding up the ways <span>$0$</span> to <span>$n_i$</span> extra joins can be made when adding the color <span>$i$</span>. Hereby are <span>$V_\text{b}(i-1, b-j)$</span> the number of valid configurations using just the previous colors with <span>$b-j$</span> joins, <span>$P(n_i, j)^2$</span> the ways of making <span>$j$</span> joins using <span>$j$</span> edges from a set of <span>$n_i$</span> left edges and <span>$j$</span> edges from a set of <span>$n_i$</span> right edges, and <span>$C(b, j)$</span> are the ways of merging <span>$b-j$</span> joins with the <span>$j$</span> new joins to make <span>$b$</span> joins.</p><p>For the total number of ways to make <span>$b$</span> joins using <span>$2b$</span> edges, regardless whether they are valid or invalid, we just pick <span>$b$</span> left edges from the total set of <span>$T_\text{b}$</span> left edges and <span>$b$</span> right edges from the total set of <span>$T_\text{b}$</span> right edges. This results in a number of <span>$P(T_\text{b}, b)^2$</span> permutations, and a corresponding probability</p><p class="math-container">\[p_\text{b}(b) = \frac{V_\text{b}(B, b)}{P(T_\text{b}, b)^2}\]</p><p>that all <span>$b$</span> frame joins are valid, using <span>$2b$</span> frame edges.</p><h3 id="Probabilities-of-valid-inner-joins"><a class="docs-heading-anchor" href="#Probabilities-of-valid-inner-joins">Probabilities of valid inner joins</a><a id="Probabilities-of-valid-inner-joins-1"></a><a class="docs-heading-anchor-permalink" href="#Probabilities-of-valid-inner-joins" title="Permalink"></a></h3><p>The approach for the inner joins works similar to that one for the frame joins. The difference in this case is that there is no such notion of left or right edges for the inner joins, and thus instead of <span>$P(n_i, j)^2$</span> ways to make <span>$j$</span> joins from the <span>$n_i$</span> left and <span>$n_i$</span> right edges of color <span>$i$</span> we now have <span>$P(2n_i, 2j)$</span> ways to pick any <span>$2j$</span> edges from the total of <span>$2n_i$</span> edges with that color.</p><p>Let <span>$M$</span> be the number of different inner colors, with color numbers assigned from <span>$1$</span> to <span>$M$</span>. Again, let <span>$2n_i$</span> be the number of edges of color <span>$i$</span> and <span>$2T_\text{m} = 2\sum_{i=1}^M n_i$</span> the total number of inner edges over all pieces. Define <span>$V_\text{m}(i, m)$</span> to be the number of valid configurations of how <span>$m$</span> inner joins can be made using <span>$2m$</span> edges of colors <span>$1$</span> to <span>$i$</span>. Then we have again</p><p class="math-container">\[\begin{align*}
V_\text{m}(0, 0) &amp;= 1 \\
V_\text{m}(0, m) &amp;= 0 \quad \text{for} \quad m &gt; 0
\end{align*}\]</p><p>and the recursive formula</p><p class="math-container">\[V_\text{m}(i, m) = \sum_{j=0}^{n_i} V_\text{m}(i-1, m-j)\cdot P(2n_i, 2j)\cdot C(m, j)\]</p><p>from which follows the probability</p><p class="math-container">\[p_\text{m}(m) = \frac{V_\text{m}(M, m)}{P(2T_\text{m}, 2m)}\]</p><p>that all <span>$m$</span> inner joins are valid, using <span>$2m$</span> inner edges.</p><p>Figures 1 and 2 show the probabilities of a particular join to be valid, plotted over the cumulative number of joins for the Eternity II puzzle with 256 pieces, 60 total frame joins and 420 total inner joins.</p><figure>
  <picture style="width: 100%">
    <source srcset="../assets/frame_probabilities_dark.svg" media="(prefers-color-scheme: dark)">
    <img src="../assets/frame_probabilities.svg">
  </picture>
  <figcaption><b>Figure 1</b>: Probabilities of valid frame joins for the Eternity II puzzle with 256 pieces</figcaption>
</figure>

<figure>
  <picture style="width: 100%">
    <source srcset="../assets/inner_probabilities_dark.svg" media="(prefers-color-scheme: dark)">
    <img src="../assets/inner_probabilities.svg">
  </picture>
  <figcaption><b>Figure 2</b>: Probabilities of valid inner joins for the Eternity II puzzle with 256 pieces</figcaption>
</figure><h3 id="Solutions-and-search-tree-estimates"><a class="docs-heading-anchor" href="#Solutions-and-search-tree-estimates">Solutions and search tree estimates</a><a id="Solutions-and-search-tree-estimates-1"></a><a class="docs-heading-anchor-permalink" href="#Solutions-and-search-tree-estimates" title="Permalink"></a></h3><p>The product of the probabilities for <span>$b$</span> valid frame joins made from <span>$2b$</span> frame edges and <span>$m$</span> valid inner joins  made from <span>$2m$</span> inner edges and the total number of piece configurations with <span>$p_\text{c}$</span> placed corner pieces, <span>$p_\text{e}$</span> placed edge pieces and <span>$p_\text{i}$</span> placed inner pieces gives an estimation for the number of partial solutions of a partially filled board:</p><p class="math-container">\[S(p_\text{c}, p_\text{e}, p_\text{i}, b, m) = P(p_\text{c}, p_\text{e}, p_\text{i})\cdot p_\text{b}(b)\cdot p_\text{m}(m)\]</p><p>For a board with <span>$r$</span> rows and <span>$c$</span> columns, that has</p><p class="math-container">\[\begin{align*}
s_\text{c} &amp;= 4 \\
s_\text{e} &amp;= 2(r-2) + 2(c-2) = 2r + 2c - 8 \\
s_\text{i} &amp;= (r-2)(c-2)
\end{align*}\]</p><p>corner squares, edge squares and inner squares, and using</p><p class="math-container">\[\begin{align*}
b &amp;= 2(r-1) + 2(c-1) \\
m &amp;= (r-1)(c-2) + (r-2)(c-1)
\end{align*}\]</p><p>as the total numbers of frame joins and inner joins on the board, we finally have the estimation for the number of puzzle solutions of the entirely filled board.</p><p>Table 1 compares the predicted numbers of solutions with empirical results for the two smaller puzzles with 36 pieces that are shown in figure 3.</p><figure style="display: flex; justify-content: space-around; flex-wrap: wrap">
  <span></span>
  <figure style="width: 40%">
    <img src="../assets/pieces_06x06.png">
    <figcaption>Puzzle A: 3 frame colors, 5 inner colors,<br>160 solutions</figcaption>
  </figure>
  <figure style="width: 40%">
    <img src="../assets/clue1.png">
    <figcaption>Puzzle B: 4 frame colors, 3 inner colors, 115071633408 solutions</figcaption>
  </figure>
  <figcaption><b>Figure 3</b>: 6x6 puzzles with different characteristics</figcaption>
</figure><table><tr><th style="text-align: right"></th><th style="text-align: right">Puzzle A</th><th style="text-align: right">Puzzle B</th><th style="text-align: right">Eternity II</th></tr><tr><td style="text-align: right">estimated solutions</td><td style="text-align: right">146</td><td style="text-align: right">262881014825</td><td style="text-align: right">14702</td></tr><tr><td style="text-align: right">actual solutions</td><td style="text-align: right">160</td><td style="text-align: right">115071633408</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">symmetries due to the board</td><td style="text-align: right">4</td><td style="text-align: right">4</td><td style="text-align: right">1</td></tr><tr><td style="text-align: right">symmetries due to symmetric pieces</td><td style="text-align: right">1</td><td style="text-align: right">4</td><td style="text-align: right">1</td></tr><tr><td style="text-align: right">symmetries due to identical pieces</td><td style="text-align: right">1</td><td style="text-align: right">384</td><td style="text-align: right">1</td></tr><tr><td style="text-align: right">total symmetries</td><td style="text-align: right">4</td><td style="text-align: right">6144</td><td style="text-align: right">1</td></tr></table><figure>
  <figcaption><b>Table 1</b>: Estimated and empirical numbers of solutions for different puzzles</figcaption>
</figure><p>A backtracking search algorithm gradually fills the board with pieces one after another, and following a given search order, which maps each search depth to a particular square on the board. After each placed piece for that search order we can count the total numbers of the already placed corner, edge and inner pieces, as well as the numbers of frame joins and inner joins between neighboring pieces, and then estimate the number of partial solutions for that particular, partially filled board. The cumulative sum of these partial solutions, from placing the first until the last piece, represents an estimation for the total numbers of nodes in the search tree.</p><p>It has been observed that the predicted numbers from the theoretical model matches empirical results gathered by exhaustive searches very well, and the relative error becomes smaller with bigger puzzle sizes. Figure 4 shows two different puzzles with 64 pieces, but with the same characteristics (3 frame colors, 8 inner colors, no symmetric or identical pieces), and figure 5 visualizes the estimated and empirical numbers of nodes for each depth in the search tree, using a simple rowscan search order starting from the bottom-left corner.</p><figure style="display: flex; justify-content: space-around; flex-wrap: wrap">
  <span></span>
  <figure style="width: 40%">
    <img src="../assets/pieces_08x08_set_1.png">
    <figcaption>Puzzle C: 52 solutions</figcaption>
  </figure>
  <figure style="width: 40%">
    <img src="../assets/pieces_08x08_set_2.png">
    <figcaption>Puzzle D: 96 solutions</figcaption>
  </figure>
  <figcaption><b>Figure 4</b>: 8x8 puzzles with 3 frame colors and 8 inner colors</figcaption>
</figure><figure>
  <picture style="width: 100%">
    <source srcset="../assets/search_tree_8x8_dark.svg" media="(prefers-color-scheme: dark)">
    <img src="../assets/search_tree_8x8.svg">
  </picture>
  <figcaption><b>Figure 5</b>: Estimated and empirical numbers of nodes in the search tree</figcaption>
</figure><p>Figure 6 visualizes different search orders for the original Eternity II puzzle with a single fixed piece on square I8, and shows the total number of nodes in the corresponding search trees. It is worth to mention that the optimal optimal search order depends on the specific properties of the puzzle, i.e. the board size, the number of frame and inner colors, the distribution of colors, and the number of symmetries in the pieces.</p><figure style="display: flex; justify-content: space-around; flex-wrap: wrap">
  <span></span>
  <figure style="width: 40%">
    <img src="../assets/path_rowscan.svg">
    <figcaption>Horizontal rowscan - 1.365e+47 nodes</figcaption>
  </figure>
  <figure style="width: 40%">
    <img src="../assets/path_best.svg">
    <figcaption>Best known search order - 1.364e+47 nodes</figcaption>
  </figure>
  <figure style="width: 40%">
    <img src="../assets/path_frame_rowscan.svg">
    <figcaption>Frame first, then horizontal rowscan - 1.110e+57 nodes</figcaption>
  </figure>
  <figure style="width: 40%">
    <img src="../assets/path_zig_zag.svg">
    <figcaption>Diagonal zig-zag path - 4.176e+53 nodes</figcaption>
  </figure>
  <figure style="width: 40%">
    <img src="../assets/path_spiral_in.svg">
    <figcaption>Spiral-in path - 3.979e+57 nodes</figcaption>
  </figure>
  <figure style="width: 40%">
    <img src="../assets/path_spiral_out.svg">
    <figcaption>Spiral-out path - 1.556e+57 nodes</figcaption>
  </figure>
  <figcaption><b>Figure 6</b>: Different search orders and the total number of nodes in the corresponding search trees</figcaption>
</figure><figure>
  <picture style="width: 100%">
    <source srcset="../assets/search_tree_dark.svg" media="(prefers-color-scheme: dark)">
    <img src="../assets/search_tree.svg">
  </picture>
  <figcaption><b>Figure 7</b>: Search tree estimates for selected search orders</figcaption>
</figure><h2 id="Estimates-with-invalid-joins"><a class="docs-heading-anchor" href="#Estimates-with-invalid-joins">Estimates with invalid joins</a><a id="Estimates-with-invalid-joins-1"></a><a class="docs-heading-anchor-permalink" href="#Estimates-with-invalid-joins" title="Permalink"></a></h2><p>For a simple backtracking approach, the search space of the Eternity II puzzle with 256 pieces is too large for a realistic chance of finding one of the solutions. A different objective can be to optimize for the best score, i.e. the highest number of valid joins on the board. This involves to allow a certain amount of mismatched edges while placing new pieces onto the board. Since the probability of valid joins between two random frame pieces of the Eternity II puzzle is higher than the probability of valid inner joins, the following model only considers the invalid joins between two inner edges and assumes that all edges between the frame pieces must still match.</p><p>Let <span>$p_\text{m}(m, v)$</span> be the probability that the first <span>$v$</span> inner joins are valid and the rest are not, using <span>$2m$</span> inner edges. This probability can be calculated using the recursive relation</p><p class="math-container">\[p_\text{m}(m, v) = p_\text{m}(m-1, v) - p_\text{m}(m, v+1)\]</p><p>and the special case of all <span>$m$</span> inner joins to be valid was already considered above, therefore</p><p class="math-container">\[p_\text{m}(m, m) = p_\text{m}(m)\]</p><p>If we want to allow the <span>$v$</span> valid inner joins to be anywhere on the board, we still have to multiply <span>$p_\text{m}(m, v)$</span> with the number of ways to arrange <span>$v$</span> valid joins over <span>$m$</span> positions, i.e. with a factor <span>$C(m, v) = C(m, m-v)$</span>.</p><p>More convenient for practical calculations is the probability of <strong>at most</strong> <span>$N = m - v$</span> invalid inner joins, using <span>$2m$</span> edges. In this case we have to sum up the probabilities <span>$p_\text{m}(m, m-0)$</span> for no invalid joins, <span>$p_\text{m}(m, m-1)$</span> for 1 invalid join, up to <span>$p_\text{m}(m, m-N)$</span> for <span>$N$</span> invalid joins, with each of these probabilities multiplied the number of ways of arranging the corresponding number of invalid joins over all of the <span>$m$</span> inner joins:</p><p class="math-container">\[p_\text{m} = \sum_{i=0}^N p_\text{m}(m, m-i)\cdot C(m, i)\]</p><p>Here, for simplicity the notation <span>$p_\text{m}$</span> on the left side of the equation represents the overall probability regarding the inner joins, and its exact meaning should be clear from context, i.e. in this case it is the probability for up to <span>$N$</span> invalid joins anywhere on the board.</p><p>Since allowing invalid joins increases the numbers of possible piece candidates for each square in a backtracking algorithm, an efficient implementation would likely restrict where exactly on the board these invalid joins are allowed. For example, instead of right from the beginning and over the entire board, the invalid joins might only be gradually allowed towards the end of the search, after some specified numbers of placed pieces (&quot;slip array&quot;). In this case we have to replace the factor <span>$C(m, i)$</span> in the equation by the number of ways to arrange <span>$i$</span> invalid joins over a total of <span>$m$</span> joins, while satisfying the restictions from the given slip array.</p><p>Let <span>$d=[d_1, d_2, \ldots, d_N]$</span> with <span>$d_1\le d_2\le\ldots\le d_N$</span> be an ordered slip array with <span>$N$</span> entries, that specifies the search depths (i.e. the number of placed pieces) at which another invalid join is allowed. For example, <span>$d=[220, 230, 240]$</span> means that the first 219 pieces must be placed without any invalid joins, from piece 220 to 229 at most one invalid join is allowed, from piece 230 to 239 at most two (cumulative) invalid joins, and a third invalid join is allowed when at least 240 pieces are placed. It is not strictly necessary that the first invalid join occurs somewhere between piece 220 to 229; instead, all of the three allowed invalid joins might be between the last few placed pieces, or there can also be fewer than three invalid joins in total. Note that multiple consecutive numbers with the same value in <span>$d$</span> are allowed, in which case the corresponding number of new invalid joins are allowed from that particular search depth. For example, to allow up to four invalid inner joins anywhere on the board, you could simply set <span>$d=[1, 1, 1, 1]$</span> (in practice it doesn&#39;t really make sense to have more than two consecutive numbers with the same value, because new pieces are usually only placed with exactly two of their edges adjacent to other pieces on the board). Also note that by defining the allowed invalid joins in form of the slip array, their allowed positions on the board are dependent on the search order.</p><p>Let <span>$j(p)$</span> be the number of completed (either valid or invalid) inner joins after <span>$p$</span> placed pieces, with <span>$1\le p\le p_\text{max}$</span> and <span>$p_\text{max}$</span> being the total number of squares on the board. The values <span>$j(p)$</span> depend on the exact placement order of the pieces, but they can easily be precomputed and stored in an array.</p><p>Let <span>$W(p, i)$</span> be the number of ways to arrange exactly <span>$i$</span> invalid inner joins after <span>$p$</span> placed pieces on the board, that satisfy the constraints from the given slip array <span>$d$</span>.</p><p>Obviously <span>$W(p, i) = 0$</span> if <span>$p &lt; d_i$</span>, because <span>$i$</span> invalid joins are not permitted when fewer than <span>$d_i$</span> pieces are placed on the board.</p><p>For a single invalid join any of the last <span>$j(p) - j(d_1-1)$</span> positions is allowed, and therefore</p><p class="math-container">\[W(p, 1) = C(j(p) - j(d_1-1), 1) = j(p) - j(d_1-1)\]</p><p>For exactly <span>$i=2$</span> invalid joins, either both of them can be between <span>$d_2$</span> and <span>$p$</span> placed pieces (here &quot;between&quot; means the bounds <span>$d_2$</span> and <span>$p$</span> are inclusive), or one of them can be between <span>$d_1$</span> and <span>$d_2 - 1$</span> placed pieces and the other one between <span>$d_2$</span> and <span>$p$</span> placed pieces. For the first case we have <span>$C(j(p) - j(d_2-1), 2)$</span> combinations to arrange the two invalid joins, and for the second case we have <span>$C(j(d_2-1) - j(d_1-1), 1)\cdot C(j(p) - j(d_2-1), 1)$</span> combinations to arrange them. In total this gives</p><p class="math-container">\[W(p, 2) = C(j(p) - j(d_2-1), 2) + \underbrace{C(j(d_2-1) - j(d_1-1), 1)}_{W(d_2-1, 1)}\cdot C(j(p) - j(d_2-1), 1)\]</p><p>possible configurations for exactly 2 invalid joins.</p><p>Now consider an arbitrary number of exactly <span>$i$</span> invalid joins after <span>$p$</span> placed pieces. We can list the different cases:</p><ol><li>All <span>$i$</span> invalid joins occur between <span>$d_i$</span> and <span>$p$</span> placed pieces. This gives <span>$C(j(p) - j(d_i-1), i)$</span> possible configurations.</li><li>There is exactly 1 invalid join between <span>$d_1$</span> and <span>$d_i - 1$</span> placed pieces and the other <span>$i-1$</span> invalid joins occur between <span>$d_i$</span> and <span>$p$</span> placed pieces. This gives <span>$C(j(d_i-1) - j(d_1-1), 1)\cdot C(j(p) - j(d_i-1), i-1)$</span> possible configurations. Notice that the first term in that product is equal to <span>$W(d_i - 1, 1)$</span>.</li><li>There are exactly 2 invalid joins between <span>$d_1$</span> and <span>$d_i - 1$</span> placed pieces and the other <span>$i-2$</span> invalid joins occur between <span>$d_i$</span> and <span>$p$</span> placed pieces. We have already calculated the number of possible configurations for the first 2 invalid joins in the previous paragraph if we again set <span>$p = d_i - 1$</span>. This gives <span>$W(d_i - 1, 2)\cdot C(j(p) - j(d_i-1), i-2)$</span> possible configurations.</li><li>There are exactly <span>$k$</span> invalid joins between <span>$d_1$</span> and <span>$d_i - 1$</span> placed pieces and the other <span>$i-k$</span> invalid joins occur between <span>$d_i$</span> and <span>$p$</span> placed pieces. This gives <span>$W(d_i - 1, k)\cdot C(j(p) - j(d_i-1), i-k)$</span> possible configurations.</li><li>There are exactly <span>$i-1$</span> invalid joins between <span>$d_1$</span> and <span>$d_i - 1$</span> placed pieces and the last invalid join occurs between <span>$d_i$</span> and <span>$p$</span> placed pieces. This gives <span>$W(d_i - 1, i - 1)\cdot C(j(p) - j(d_i-1), 1)$</span> possible configurations.</li></ol><p>The total number of possible configurations for <span>$i$</span> invalid joins is the sum of all of these cases, which can be written in a recursive way</p><p class="math-container">\[\begin{align*}
W(p, i) &amp;= \begin{cases} \sum\limits_{k=0}^{i-1} W(d_i - 1, k)\cdot C(j(p) - j(d_i-1), i-k) &amp; \text{if} &amp; p\ge d_i \\ 0 &amp; \text{if} &amp; p &lt; d_i \end{cases} \\
W(p, 0) &amp;= 1
\end{align*}\]</p><p>Using this expression, we can now calculate the probability for the inner joins with up to <span>$N$</span> invalid joins after <span>$p$</span> placed pieces, that satisfy the restrictions from the given slip array, as</p><p class="math-container">\[p_\text{m} = \sum_{i=0}^N p_\text{m}(m, m-i)\cdot W(p, i)\]</p><p>Note that if invalid joins are allowed only for the inner edges, the optimal search order is usually different from the best search order if no invalid joins were allowed. The reason for that is because allowing mismatching inner edges significantly increases the number of possible piece candidates for the inner board squares. Therefore a search order which prioritizes the frame squares during the later phase of the search when invalid joins are allowed is more efficient than a search order which for example leaves the entire top row of the board until the very end. Figures 8 and 9 show the total number of nodes in the search tree for two different search orders, assuming that up to 10 invalid inner joins (target score 470) within the four topmost rows of the Eternity II board are allowed, which corresponds to the slip array</p><p class="math-container">\[[192, 192, 192, 192, 192, 192, 192, 192, 192, 192]\]</p><p>and an estimated number of <span>$1.481\cdot 10^{25}$</span> piece configurations that satisfy these constraints. Here the search order on the right, which only fills the first 12 rows horizontally and then the last 4 rows vertically, is over 80% more efficient than a full horizontal rowscan over the entire board.</p><figure style="display: flex; justify-content: space-around; flex-wrap: wrap">
  <span></span>
  <figure style="width: 40%">
    <img src="../assets/path_rowscan.svg">
    <figcaption>Horizontal rowscan - 3.715e+58 nodes</figcaption>
  </figure>
  <figure style="width: 40%">
    <img src="../assets/path_rowscan2.svg">
    <figcaption>Horizontal rowscan with the last 4 rows filled vertically - 7.000e+57 nodes</figcaption>
  </figure>
  <figcaption><b>Figure 8</b>: Two search orders for the Eternity II puzzle with up to 10 invalid joins allowed</figcaption>
</figure><figure>
  <picture style="width: 100%">
    <source srcset="../assets/search_tree_470_dark.svg" media="(prefers-color-scheme: dark)">
    <img src="../assets/search_tree_470.svg">
  </picture>
  <figcaption><b>Figure 9</b>: Search tree estimates with up to 10 invalid joins allowed</figcaption>
</figure><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><div class="citation canonical"><dl><dt>[1]</dt><dd><div id="Owen2008">B. Owen. <em>Complex theory</em>, <a href="https://groups.io/g/eternity2/message/5209"><code>https://groups.io/g/eternity2/message/5209</code></a> (2008).</div></dd><dt>[2]</dt><dd><div id="Owen2009">B. Owen. <em>Complex theory with edge slip</em>, <a href="https://groups.io/g/eternity2/message/6408"><code>https://groups.io/g/eternity2/message/6408</code></a> (2009).</div></dd></dl></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Overview</a><a class="docs-footer-nextpage" href="../solvers/">Solvers »</a><div class="flexbox-break"></div></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Friday 17 October 2025 01:57">Friday 17 October 2025</span>. Using Julia version 1.12.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
